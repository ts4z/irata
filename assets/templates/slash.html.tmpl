<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>{{ .SiteConfig.Name }}</title>
    <link rel="stylesheet" href="/fs/{{- .SiteConfig.Theme -}}-style.css">
</head>
<body>
    {{ template "user-bar" . }}
    <div class="container">
        <h1>{{ .SiteConfig.Name }}</h1>

        {{ if or .IsOperator .IsAdmin }}
        <div class="admin-bar">
            {{ if .IsOperator }}
            <div style="margin-top: 0.5em;">
                <span style="opacity: 0.7;">Create:</span> <a href="/create/tournament">Tournament</a>
            </div>
            {{ end }}
            <div style="margin-top: 0.3em;">
                <span style="opacity: 0.7;">Manage:</span> 
                {{ if .IsAdmin }}
                <a href="/manage/site">Site</a> 
                {{ end }}
                {{ if .IsOperator }}
                <a href="/manage/footer-set">Footer Plugs</a> 
                <a href="/manage/structure">Structures</a>
                {{ end }}
                {{ if .IsAdmin }}
                <a href="/manage/users">Users</a>
                {{ end }}
            </div>
        </div>
        {{ end }}

        <table class="data-table">
            <thead>
                <tr>
                    <th>Tournament</th>
                    <th>
                    Actions
                    </th>
                </tr>
            </thead>
            <tbody>
                {{ range .Overview.Slugs }}
                {{ with . }}
                <tr>
                    <td>
                        <a href="/t/{{.TournamentID}}"><em>{{ .TournamentName }}</em></a>
                        {{ if .Description }}
                        <br>
                        <span style="opacity: 0.8; font-size: 0.8em;">{{ .Description }}</span>
                        {{ end }}
                    </td>
                    <td>
                    {{ if $.IsOperator }}
                        <a href="/t/{{.TournamentID}}/edit">Edit</a>
                        <a href="#" class="delete-btn" onclick="confirmDeleteTournament('{{.TournamentID}}', '{{.TournamentName}}'); return false;">Delete</a>
                    {{ else }}
                    &nbsp;
                    {{ end }}
                    </td>
                </tr>
                {{ end }}
                {{ else }}
                <tr><td> No tournaments found.</td> <td> &nbsp; </td> </tr>
                {{ end }}
            </tbody>
        </table>

        {{ if not .Nick }}
        <p>
            <a href="/login">LOGIN</a> to manage tournaments and other data.
        </p>
        {{ end }}
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="confirmDialog" class="modal">
        <div class="modal-content">
            <h2>Delete Tournament?</h2>
            <p>Are you sure you want to delete tournament "<span id="tournamentToDelete"></span>"?</p>
            <p>This action cannot be undone.</p>
            <div class="modal-buttons">
                <button type="button" id="confirmBtn" style="background:#f88; color:#fff;">Delete Tournament</button>
                <button type="button" id="cancelBtn">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('confirmDialog');
            const cancelBtn = document.getElementById('cancelBtn');
            const confirmBtn = document.getElementById('confirmBtn');
            let currentTournamentId = null;

            window.confirmDeleteTournament = function(tournamentId, name) {
                currentTournamentId = tournamentId;
                document.getElementById('tournamentToDelete').textContent = name;
                modal.style.display = 'block';
            };

            cancelBtn.onclick = function() {
                modal.style.display = 'none';
            };

            confirmBtn.onclick = function() {
                if (currentTournamentId) {
                    // Navigate to delete endpoint, which will redirect back to home page
                    window.location.href = '/t/' + currentTournamentId + '/delete';
                    // Close modal immediately to provide feedback
                    modal.style.display = 'none';
                }
            };

            window.onclick = function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            };
        });
    </script>
</body>
</html>
