<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Edit Account</title>
    <link rel="stylesheet" href="/fs/{{ .Theme }}-style.css">
</head>
<body>
    {{ template "user-bar" . }}
    <div class="container">
        <div class="admin-bar">
            <a href="/">&lt; Back to Home</a>
        </div>

        <h1>Edit Your Account</h1>

{{ if .Flash }}
  <div class="flash-{{ .FlashType }}">{{ .Flash }}</div>
{{ end }}

        <!-- Change Nick Form -->
        <section style="margin-bottom: 2em;">
            <h2>Change Nick</h2>
            <form method="POST" action="/account/edit">
                <input type="hidden" name="FormType" value="nick">
                
                <div class="form-group">
                    <label for="Nick">Nick</label>
                    <input type="text" id="Nick" name="Nick" value="{{ .User.Nick }}" required>
                </div>

                <div class="actions">
                    <button type="submit">Update Nick</button>
                    <a href="/">Cancel</a>
                </div>
            </form>
        </section>

        <!-- Change Password Form -->
        <section style="margin-bottom: 2em; border-top: 1px solid #444; padding-top: 1em;">
            <h2>Change Password</h2>
            <form method="POST" action="/account/edit">
                <input type="hidden" name="FormType" value="password">
                
                <div class="form-group">
                    <label for="NewPassword">New Password</label>
                    <input type="password" id="NewPassword" name="NewPassword" required minlength="1">
                    <small>
                    {{ template "password-policy" . }}
                    </small>
                </div>

                <div class="form-group">
                    <label for="ConfirmPassword">Confirm Password</label>
                    <input type="password" id="ConfirmPassword" name="ConfirmPassword" required minlength="1">
                </div>

                <div class="actions">
                    <button type="submit">Change Password</button>
                </div>
            </form>
        </section>
    </div>

    <script>
        // Password validation: change background color based on match status
        (function() {
            const newPasswordInput = document.getElementById('NewPassword');
            const confirmPasswordInput = document.getElementById('ConfirmPassword');

            function validatePasswords() {
                const newPassword = newPasswordInput.value;
                const confirmPassword = confirmPasswordInput.value;

                // If either box is empty, use default grey color
                if (newPassword === '' || confirmPassword === '') {
                    newPasswordInput.style.background = '';
                    confirmPasswordInput.style.background = '';
                    return;
                }

                // If both boxes have content, check if they match
                if (newPassword === confirmPassword) {
                    // Match: green
                    newPasswordInput.style.background = '#2d5016';
                    confirmPasswordInput.style.background = '#2d5016';
                } else {
                    // No match: red
                    newPasswordInput.style.background = '#8b0000';
                    confirmPasswordInput.style.background = '#8b0000';
                }
            }

            // Attach event listeners
            newPasswordInput.addEventListener('input', validatePasswords);
            confirmPasswordInput.addEventListener('input', validatePasswords);
        })();
    </script>
</body>
</html>
