<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Manage Structures</title>
    <link rel="stylesheet" href="/style/{{ .Theme }}/css">
</head>
<body>
    {{ template "user-bar" . }}
    <div class="container">
        <div class="admin-bar">
            <a href="/">&lt; Back to Home</a>
        </div>

        <h1>Manage Structures</h1>
        
        <table class="data-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Levels</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="3" style="text-align: center;"><a href="/create/structure">‚ú® Create New</a></td>
                </tr>
                {{ range $i, $s := .Structures }}
                <tr>
                    <td>{{ $s.Name }}</td>
                    <td>
                        {{ len $s.Levels }} levels, {{ $s.StructureData.ChipsPerBuyIn }} chips per buy-in
                        {{- if $s.StructureData.ChipsPerAddOn }}{{- $s.StructureData.ChipsPerAddOn }} chips per add-on{{ end }}
                        <br>
                        <select style="width: 100%; margin-top: 0.5em;">
                        {{ range $i, $lvl := $s.Levels }}
                            <option {{ if eq $i 1 }}selected{{ end }}>{{ $lvl.DurationMinutes }} min - {{ $lvl.Description }} {{ if $lvl.IsBreak }}(Break){{ end }}</option>
                        {{ end }}
                        </select>
                    </td>
                    <td>
                        <a href="/manage/structure/{{ $s.ID }}/edit" class="no-underline" title="Edit">‚úèÔ∏è</a>
                        <a href="/create/structure?template={{ $s.ID }}" class="no-underline" title="Copy">üìã</a>
                        <a href="#" class="no-underline" style="color:#f88;" title="Delete" onclick="showDeleteModal('{{ $s.Name }}', {{ $s.ID }})">‚ùå</a>
                    </td>
                </tr>
                {{ end }}
            </tbody>
        </table>

        <!-- Delete Confirmation Modal -->
        <div id="deleteModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:1000;">
            <div style="position:relative; top:50%; transform:translateY(-50%); margin:auto; padding:2em; background:#222; max-width:500px; border-radius:8px; text-align:center;">
                <p id="deleteModalText"></p>
                <form id="deleteForm" method="GET" style="margin-top:1em;">
                    <button type="submit" style="background:#f88; color:#fff; border:none; padding:0.5em 1em; border-radius:4px;">Confirm Delete</button>
                    <button type="button" onclick="hideDeleteModal()" style="margin-left:1em;">Cancel</button>
                </form>
            </div>
        </div>

        <script>
            function showDeleteModal(name, id) {
                document.getElementById('deleteModalText').textContent = `Are you sure you want to delete structure "${name}"?`;
                document.getElementById('deleteForm').action = `/manage/structure/${id}/delete`;
                document.getElementById('deleteModal').style.display = 'block';
            }

            function hideDeleteModal() {
                document.getElementById('deleteModal').style.display = 'none';
            }
        </script>
    </div>
</body>
</html>
