<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Manage Site Info</title>
    <link rel="stylesheet" href="/fs/irata-style.css">
</head>
<body>
    {{ template "user-bar" . }}
    <div class="container">
        <div class="admin-bar">
            <a href="/">&lt; Back to Home</a>
        </div>

        {{ if .Flash }}<div class="flash-{{ .FlashType }}">{{ .Flash }}</div>{{ end }}

        <h1>Manage Site Info</h1>
        <form method="POST">
            <label for="Name">Site Name</label>
            <input type="text" id="Name" name="Name" value="{{ .Config.Name }}" required>

            <label for="CookieDomain">Cookie Domain</label>
            <input type="text" id="CookieDomain" name="CookieDomain" value="{{ .Config.CookieDomain }}" required>

            <div class="form-section">
            <h2>CORS</h2>
            <label for="AllowedOriginDomains">Allowed Origins (comma-separated)</label>
            <input type="text" id="AllowedOriginDomains" name="AllowedOriginDomains" value="{{ join .Config.AllowedOriginDomains "," }}" required>

            <label for="BonusHTTPPorts">Bonus HTTP Ports (comma-separated)</label>
            <input type="text" id="BonusHTTPPorts" name="BonusHTTPPorts" value="{{ joinInts .Config.BonusHTTPPorts "," }}">
            </div>

            <label for="Theme">Theme</label>
            <input type="text" id="Theme" name="Theme" value="{{ .Config.Theme }}" required>

            <label for="DefaultNextLevelSoundID">Default Next Level Sound</label>
            <div class="sound-select-container">
                <select id="DefaultNextLevelSoundID" name="DefaultNextLevelSoundID">
                    {{- range $_, $se := .Sounds }}
                    <option value="{{ .ID }}" data-path="{{ $se.Path }}"
                      {{- if eq .ID $.Config.DefaultNextLevelSoundID }} selected {{ end -}}
                      >{{ $se.Name }} ({{- $se.Description -}})</option>
                    {{- end }}
                </select>
                <button type="button" id="PlaySoundBtn" class="sound-play-btn" title="Play selected sound">â–¶</button>
            </div>

            <div class="actions">
                <button type="submit">Save</button>
            </div>
        </form>
        {{ if .Flash }}<div class="flash-{{ .FlashType }}">{{ .Flash }}</div>{{ end }}
    </div>

    <script>
        // Sound preview functionality
        let currentAudio = null;

        function playSelectedSound() {
            const select = document.getElementById('DefaultNextLevelSoundID');
            const selectedOption = select.options[select.selectedIndex];
            const soundPath = selectedOption.getAttribute('data-path');
            
            // Stop any currently playing sound
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }

            // Don't play if no path
            if (!soundPath || soundPath === '') {
                return;
            }

            // Create and play new audio
            currentAudio = new Audio(soundPath);
            currentAudio.play().catch(error => {
                console.error('Error playing sound:', error);
                alert('Failed to play sound: ' + error.message);
            });
        }

        // Set up sound play button
        document.addEventListener('DOMContentLoaded', function() {
            const playBtn = document.getElementById('PlaySoundBtn');
            if (playBtn) {
                playBtn.addEventListener('click', playSelectedSound);
            }
        });
    </script>
</body>
</html>